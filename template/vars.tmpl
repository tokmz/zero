{{define "vars"}}
// Code generated by github.com/tokmz/zero. DO NOT EDIT.
// Generated at: {{now "2006-01-02 15:04:05"}}

package {{.Package}}

import (
	"context"
	"database/sql"

	"gorm.io/gorm"
)

var (
	// DB 默认数据库连接
	DB *gorm.DB

	// DBMap 多数据库连接
	DBMap = make(map[string]*gorm.DB)

	// 查询对象
	{{- range .Tables}}
	{{.ModelName | toLowerCamel}}QueryObj = &{{.ModelName | toLowerCamel}}Query{}
	{{- end}}
)

// SetDB 设置默认数据库连接
func SetDB(db *gorm.DB) {
	DB = db
	// 初始化查询对象
	{{- range .Tables}}
	{{.ModelName | toLowerCamel}}QueryObj.Use(db)
	{{- end}}
}

// SetDBMap 设置多数据库连接
func SetDBMap(dbMap map[string]*gorm.DB) {
	for name, db := range dbMap {
		DBMap[name] = db
	}
}

// GetDB 获取数据库连接
func GetDB(name ...string) *gorm.DB {
	if len(name) == 0 || name[0] == "" {
		return DB
	}
	return DBMap[name[0]]
}

// Transaction 事务处理
func Transaction(fc func(tx *gorm.DB) error, opts ...*sql.TxOptions) error {
	return DB.Transaction(fc, opts...)
}

// TransactionCtx 带上下文的事务处理
func TransactionCtx(ctx context.Context, fc func(tx *gorm.DB) error, opts ...*sql.TxOptions) error {
	return DB.WithContext(ctx).Transaction(fc, opts...)
}

// 查询方法
{{- range .Tables}}
func {{.ModelName}}Query() *{{.ModelName | toLowerCamel}}Query {
	return {{.ModelName | toLowerCamel}}QueryObj
}
{{- end}}
{{end}}